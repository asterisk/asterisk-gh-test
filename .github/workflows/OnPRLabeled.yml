name: OnPRLabeled
run-name: "${{github.workflow}}-${{github.event.label.name}}-${{github.event.number}}"
on:
  pull_request_target:
    types: [ labeled ]

concurrency:
  group: ${{github.workflow}}-${{github.event.label.name}}-${{github.event.number}}
  cancel-in-progress: true

env:
  PR_NUMBER:          ${{ github.event.number }}
  MODULES_BLACKLIST:  ${{ vars.GATETEST_MODULES_BLACKLIST }} ${{ vars.UNITTEST_MODULES_BLACKLIST }}

jobs:
  AsteriskCherryPickTest:
    name: CherryPickTest
    if: ${{ github.event.label.name == vars.CHERRY_PICK_TEST_LABEL }}
    uses: asterisk/asterisk-ci-actions/.github/workflows/AsteriskCherryPickTest.yml@main
    secrets:
      TOKEN: ${{ secrets.GITHUB_TOKEN }}

  AsteriskRecheckPR:
    name: Recheck
    if: ${{ github.event.label.name == vars.RECHECKPR_LABEL }}
    uses: asterisk/asterisk-ci-actions/.github/workflows/AsteriskUnitGateTest.yml@main
    with:
      test_type:         prrecheck
      asterisk_repo:     ${{github.repository}}
      pr_number:         ${{github.event.number}}
      base_branch:       ${{github.event.pull_request.base.ref}}
      build_options:     ${{vars.BUILD_OPTIONS}}
      unittest_command:  ${{vars.UNITTEST_COMMAND}}
      testsuite_repo:    ${{vars.TESTSUITE_REPO}}
      gatetest_list:     ${{vars.GATETEST_LIST}}
      gatetest_commands: ${{vars.GATETEST_COMMANDS}}
    secrets:
      TOKEN: ${{ secrets.GITHUB_TOKEN }}
      