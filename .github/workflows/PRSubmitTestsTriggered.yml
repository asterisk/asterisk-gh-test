name: PRSubmitTestsTriggered
run-name: "PRSubmitTestsTriggered ${{github.event.number}} ${{github.event.action}} by ${{ github.actor }}"
on:
  workflow_run:
    workflows: [PRSubmitTests]
    types:
      - in_progress

jobs:
  PRSubmitTestsTriggered:
    runs-on: ubuntu-latest
    steps:
      - name: 'Set Label'
        uses: actions/github-script@v6
        env:
          LABEL_TIP: ${{ vars.PR_SUBMIT_TESTING_IN_PROGRESS }}
        with:
          retries: 5
          script: |
            let prs = await github.rest.search.issuesAndPullRequests({
                 q: context.payload.workflow_run.head_sha,
              });
            if (prs.data.total_count == 0) {
              core.setFailed(`Unable to get PR for ${context.payload.workflow_run.head_sha`);
              return;
            }
            let pr_number = prs.data.items[0].number;
            github.rest.issues.setLabels({
              issue_number: pr_number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: [ process.env.LABEL_TIP ]
            });

